!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.sdlang=t():e.sdlang=t()}(this,(function(){return(()=>{"use strict";var e={d:(t,r)=>{for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{SdlAttribute:()=>h,SdlNamedBased:()=>i,SdlReader:()=>y,SdlTag:()=>l,SdlTokenType:()=>m,SdlValue:()=>a,SdlValueType:()=>r,parseAndVisit:()=>d});var r,n,i=function(){function e(e){this._qualifiedName=e,this.qualifiedName=e}return Object.defineProperty(e.prototype,"qualifiedName",{get:function(){return this._qualifiedName},set:function(e){var t=e.indexOf(":");0<=t&&(this._namespaceColonIndex=t),this._qualifiedName=e,this._name=void 0,this._namespace=void 0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){if(this._name)return this._name;if(void 0!==this._namespaceColonIndex){var e=this._namespaceColonIndex+1;this._name=this._qualifiedName.slice(e)}else this._name=this._qualifiedName;return this._name},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"namespace",{get:function(){return this._namespace?this._namespace:void 0===this._namespaceColonIndex?"":(this._namespace=this._qualifiedName.slice(0,this._namespaceColonIndex),this._namespace)},enumerable:!1,configurable:!0}),e}(),o=function(){return(o=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};(n=r||(r={}))[n.ERROR=0]="ERROR",n[n.Number=1]="Number",n[n.Boolean=2]="Boolean",n[n.Null=3]="Null",n[n.Binary=4]="Binary",n[n.String=5]="String",n[n.DateTime=6]="DateTime",n[n.TimeSpan=7]="TimeSpan";var a=function(){function e(e){if("object"!=typeof e)throw new Error("SdlValue.constructor can only take SdlValueUnion. Use the static constructors such as SdlValue.from, SdlValue.fromString, etc.");this._value=e}return e.fromTrue=function(){return new e({type:r.Boolean,value:!0})},e.fromFalse=function(){return new e({type:r.Boolean,value:!1})},e.fromBoolean=function(t){return new e({type:r.Boolean,value:t})},e.fromNull=function(){return new e({type:r.Null,value:null})},e.fromNumber=function(t){return new e({type:r.Number,value:t})},e.fromBinary=function(t){return new e({type:r.Binary,value:t})},e.fromString=function(t){return new e({type:r.String,value:t})},e.fromDateTime=function(t){return new e({type:r.DateTime,value:t})},e.fromTimeSpan=function(t){return new e({type:r.TimeSpan,value:t})},e.from=function(t){if(null===t)return e.fromNull();switch(typeof t){case"string":return e.fromString(t);case"boolean":return e.fromBoolean(t);case"number":return e.fromNumber(t);case"object":if(t instanceof Date)return e.fromDateTime(t);if(void 0!==t.days)return e.fromTimeSpan(t);throw new Error("Can't construct an SdlValue from object. Only Date and SdlTimeSpan objects are allowed: "+t);default:throw new Error("Can't construct an SdlValue from: "+t)}},Object.defineProperty(e.prototype,"number",{get:function(){return this.getValueEnforceType(this._value,r.Number)},set:function(e){this._value={type:r.Number,value:e}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"boolean",{get:function(){return this.getValueEnforceType(this._value,r.Boolean)},set:function(e){this._value={type:r.Boolean,value:e}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"null",{get:function(){return this.getValueEnforceType(this._value,r.Null)},set:function(e){this._value={type:r.Null,value:e}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"binary",{get:function(){return this.getValueEnforceType(this._value,r.Binary)},set:function(e){this._value={type:r.Binary,value:e}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"string",{get:function(){return this.getValueEnforceType(this._value,r.String)},set:function(e){this._value={type:r.String,value:e}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dateTime",{get:function(){return this.getValueEnforceType(this._value,r.DateTime)},set:function(e){this._value={type:r.DateTime,value:e}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"timeSpan",{get:function(){return this.getValueEnforceType(this._value,r.TimeSpan)},set:function(e){this._value={type:r.TimeSpan,value:e}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){return this._value.type},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){return this._value},set:function(e){this._value=e},enumerable:!1,configurable:!0}),e.prototype.clone=function(){switch(this._value.type){case r.Binary:return e.fromBinary(this._value.value);case r.Boolean:return e.fromBoolean(this._value.value);case r.DateTime:return e.fromDateTime(o({},this._value.value));case r.Null:return e.fromNull();case r.Number:return e.fromNumber(this._value.value);case r.String:return e.fromString(this._value.value);case r.TimeSpan:return e.fromTimeSpan(o({},this._value.value));default:throw new Error("Bug: This SdlValue is either uninitialised, or has a bad type: "+this.type)}},e.prototype.getValueEnforceType=function(e,t){if(e.type!==t)throw new TypeError("I am not a "+t+", I am: "+this.type);return e.value},e}(),s=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+r+" is not a constructor or null");e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),u=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(n=o.next()).done;)a.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a},l=function(e){function t(t,r){var n,i,o,a=e.call(this,t)||this;return a._children=null!==(n=null==r?void 0:r.children)&&void 0!==n?n:[],a._values=null!==(i=null==r?void 0:r.values)&&void 0!==i?i:[],a._attributes=null!==(o=null==r?void 0:r.attributes)&&void 0!==o?o:{},a}return s(t,e),Object.defineProperty(t.prototype,"children",{get:function(){return this._children},set:function(e){this._children=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"attributes",{get:function(){return this._attributes},set:function(e){this._attributes=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"values",{get:function(){return this._values},set:function(e){this._values=e},enumerable:!1,configurable:!0}),t.prototype.hasValueAt=function(e){return e<this.values.length},t.prototype.hasAttributeCalled=function(e){return e in this.attributes},t.prototype.hasChildAt=function(e){return e<this.children.length},t.prototype.hasChildCalled=function(e){return void 0!==this.children.find((function(t){return t.qualifiedName===e}))},t.prototype.getChildrenCalled=function(e){return this.children.filter((function(t){return t.qualifiedName===e}))},t.prototype.getValue=function(e){return this.values[e]},t.prototype.getValueNumber=function(e){return this.values[e].number},t.prototype.getValueBoolean=function(e){return this.values[e].boolean},t.prototype.getValueBinary=function(e){return this.values[e].binary},t.prototype.getValueString=function(e){return this.values[e].string},t.prototype.getValueDateTime=function(e){return this.values[e].dateTime},t.prototype.getValueTimeSpan=function(e){return this.values[e].timeSpan},t.prototype.getValueOrDefault=function(e,t){return void 0===t&&(t=null),e>=this._values.length?t:this._values[e]},t.prototype.getValueNumberOrDefault=function(e,t){var r,n;return void 0===t&&(t=0),null!==(n=null===(r=this.getValueOrDefault(e))||void 0===r?void 0:r.number)&&void 0!==n?n:t},t.prototype.getValueBooleanOrDefault=function(e,t){var r,n;return void 0===t&&(t=!1),null!==(n=null===(r=this.getValueOrDefault(e))||void 0===r?void 0:r.boolean)&&void 0!==n?n:t},t.prototype.getValueBinaryOrDefault=function(e,t){var r,n;return void 0===t&&(t=null),null!==(n=null===(r=this.getValueOrDefault(e))||void 0===r?void 0:r.binary)&&void 0!==n?n:t},t.prototype.getValueStringOrDefault=function(e,t){var r,n;return void 0===t&&(t=""),null!==(n=null===(r=this.getValueOrDefault(e))||void 0===r?void 0:r.string)&&void 0!==n?n:t},t.prototype.getValueDateTimeOrDefault=function(e,t){var r,n;return void 0===t&&(t=null),null!==(n=null===(r=this.getValueOrDefault(e))||void 0===r?void 0:r.dateTime)&&void 0!==n?n:t},t.prototype.getValueTimeSpanOrDefault=function(e,t){var r,n;return void 0===t&&(t=null),null!==(n=null===(r=this.getValueOrDefault(e))||void 0===r?void 0:r.timeSpan)&&void 0!==n?n:t},t.prototype.getAttribute=function(e){return this._attributes[e]},t.prototype.getAttributeValue=function(e){return this._attributes[e].value},t.prototype.getAttributeNumber=function(e){return this._attributes[e].value.number},t.prototype.getAttributeBoolean=function(e){return this._attributes[e].value.boolean},t.prototype.getAttributeBinary=function(e){return this._attributes[e].value.binary},t.prototype.getAttributeString=function(e){return this._attributes[e].value.string},t.prototype.getAttributeDateTime=function(e){return this._attributes[e].value.dateTime},t.prototype.getAttributeTimeSpan=function(e){return this._attributes[e].value.timeSpan},t.prototype.getAttributeValueOrDefault=function(e,t){return void 0===t&&(t=null),e in this._attributes?this._attributes[e].value:t},t.prototype.getAttributeNumberOrDefault=function(e,t){var r,n;return void 0===t&&(t=0),null!==(n=null===(r=this.getAttributeValueOrDefault(e))||void 0===r?void 0:r.number)&&void 0!==n?n:t},t.prototype.getAttributeBooleanOrDefault=function(e,t){var r,n;return void 0===t&&(t=!1),null!==(n=null===(r=this.getAttributeValueOrDefault(e))||void 0===r?void 0:r.boolean)&&void 0!==n?n:t},t.prototype.getAttributeBinaryOrDefault=function(e,t){var r,n;return void 0===t&&(t=null),null!==(n=null===(r=this.getAttributeValueOrDefault(e))||void 0===r?void 0:r.binary)&&void 0!==n?n:t},t.prototype.getAttributeStringOrDefault=function(e,t){var r,n;return void 0===t&&(t=""),null!==(n=null===(r=this.getAttributeValueOrDefault(e))||void 0===r?void 0:r.string)&&void 0!==n?n:t},t.prototype.getAttributeDateTimeOrDefault=function(e,t){var r,n;return void 0===t&&(t=null),null!==(n=null===(r=this.getAttributeValueOrDefault(e))||void 0===r?void 0:r.dateTime)&&void 0!==n?n:t},t.prototype.getAttributeTimeSpanOrDefault=function(e,t){var r,n;return void 0===t&&(t=null),null!==(n=null===(r=this.getAttributeValueOrDefault(e))||void 0===r?void 0:r.timeSpan)&&void 0!==n?n:t},t.prototype.toString=function(e,t){function n(e){o+=e.qualifiedName,o+="=",i(e.value)}function i(e){switch(e.type){case r.Binary:o+="/*TODO, sorry!*/",o+=e.binary;break;case r.Boolean:o+=e.boolean?"true":"false";break;case r.DateTime:o+=e.dateTime.getUTCFullYear().toString().padStart(4,"0")+"/"+(e.dateTime.getUTCMonth()+1).toString().padStart(2,"0")+"/"+e.dateTime.getUTCDay().toString().padStart(2,"0")+" "+e.dateTime.getUTCHours().toString().padStart(2,"0")+":"+e.dateTime.getUTCMinutes().toString().padStart(2,"0")+":"+e.dateTime.getUTCSeconds().toString().padStart(2,"0")+"."+e.dateTime.getUTCMilliseconds().toString().padStart(3,"0")+"-GMT+0";break;case r.Null:o+="null";break;case r.Number:o+=e.number.toString(10),0==e.number%1?2147483647<e.number&&(o+="L"):o+=3402823466e29<e.number||1175494351e-47>e.number?"d":"f";break;case r.String:o+='"'+e.string+'"';break;case r.TimeSpan:o+=e.timeSpan.days+"d:"+e.timeSpan.hours.toString().padStart(2,"0")+":"+e.timeSpan.minutes.toString().padStart(2,"0")+":"+e.timeSpan.seconds.toString().padStart(2,"0");break;default:throw new Error("Unhandled value type: "+e.type)}o+=" "}void 0===e&&(e=!0),void 0===t&&(t=0);var o="";return function r(a){var s,l;if(e)return e=!1,t++,a.children.forEach((function(e){return r(e)})),void t--;o+="    ".repeat(t),"content"!==a.qualifiedName&&(o+=a.qualifiedName,o+=" "),a.values.forEach((function(e){return i(e)}));try{for(var c=function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(Object.entries(a.attributes)),h=c.next();!h.done;h=c.next()){var p=u(h.value,2);p[0],n(p[1])}}catch(e){s={error:e}}finally{try{h&&!h.done&&(l=c.return)&&l.call(c)}finally{if(s)throw s.error}}return 0===a.children.length?void(o+="\n"):(o+="{\n",t++,a.children.forEach((function(e){return r(e)})),t--,o+="    ".repeat(t),void(o+="}\n"))}(this),o},t}(i),c=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+r+" is not a constructor or null");e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),h=function(e){function t(t,r){var n=e.call(this,t)||this;return n._value=r,n}return c(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this._value},set:function(e){this._value=e},enumerable:!1,configurable:!0}),t}(i),p=function(){function e(){this._parentStack=[],this._currentNode=null}return e.prototype.reset=function(){this._parentStack=[],this._parentStack.push(new l("root")),this._currentNode=null},e.prototype.visitOpenBlock=function(){if(null===this._currentNode)throw new Error("Anonymous blocks are not supported.");this._parentStack.push(this._currentNode)},e.prototype.visitCloseBlock=function(){if(1===this._parentStack.length)throw new Error("Stray '}'. We are not inside an open block (started by '{').");this._currentNode=null,this._parentStack.pop()},e.prototype.visitComment=function(){},e.prototype.visitStartTag=function(e){this._currentNode=new l(e),this._parentStack[this._parentStack.length-1].children.push(this._currentNode)},e.prototype.visitEndOfFile=function(){if(1!==this._parentStack.length)throw new Error("Tag "+this._parentStack[this._parentStack.length-1].qualifiedName+" does not have a closing bracket '}'")},e.prototype.visitNewValue=function(e){var t;null===(t=this._currentNode)||void 0===t||t.values.push(e)},e.prototype.visitNewAttribute=function(e,t){if(null===this._currentNode)throw new Error("Attributes cannot be attached to anonymous tags.");if(this._currentNode.hasAttributeCalled(t))throw new Error("Tag "+this._currentNode.qualifiedName+" already has an attribute called "+t);this._currentNode.attributes[t]=new h(t,e)},Object.defineProperty(e.prototype,"rootNode",{get:function(){if(1!==this._parentStack.length)throw new Error("This visitor hasn't parsed anything yet, or the parsing failed as the root node isn't on top.");return this._parentStack[0]},enumerable:!1,configurable:!0}),e}(),f="content";function d(e,t){function r(e){switch(e.token.type){case m.Binary:throw new Error("TODO");case m.BooleanFalse:return a.fromFalse();case m.BooleanTrue:return a.fromTrue();case m.Date:case m.DateTime:return a.fromDateTime(e.token.asDate);case m.Null:return a.fromNull();case m.NumberFloat32:case m.NumberFloat64:case m.NumberFloat128:case m.NumberInt32:case m.NumberInt64:return a.fromNumber(e.token.asNumber);case m.StringBackQuoted:case m.StringDoubleQuoted:return a.fromString(e.token.text);case m.TimeSpan:return a.fromTimeSpan({days:e.token.days,hours:e.token.hours,minutes:e.token.minutes,seconds:e.token.seconds,milliseconds:e.token.milliseconds});default:throw new Error("Expected a value token, not a token of type "+e.token.type)}}t.reset();var n=null,i=!0;for(e.read();e.token.type!==m.EndOfFile;){switch(e.token.type){case m.Binary:case m.BooleanFalse:case m.BooleanTrue:case m.Date:case m.DateTime:case m.NumberFloat128:case m.NumberFloat32:case m.NumberFloat64:case m.NumberInt32:case m.NumberInt64:case m.StringBackQuoted:case m.StringDoubleQuoted:case m.TimeSpan:i&&t.visitStartTag(f,"",f),t.visitNewValue(r(e));break;case m.BlockClose:t.visitCloseBlock();break;case m.BlockOpen:t.visitOpenBlock();break;case m.Comment:t.visitComment(e.token.text);break;case m.EndOfLine:i=!0,e.read();continue;case m.Identifier:if((n=e.clone()).read(),n.token.type===m.Equals){i&&t.visitStartTag(f,"",f),n.read(),t.visitNewAttribute(r(n),e.token.text,e.token.namespace,e.token.name),e.read(),e.read();break}if(i){t.visitStartTag(e.token.text,e.token.namespace,e.token.name);break}throw new Error("Orphaned identifier. Were you trying to make an attribute? Name = "+e.token.text);default:throw new Error("Unexpected token of type "+e.token.type)}i=!1,e.read()}t.visitEndOfFile()}var m,_,v=function(){return(v=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};!function(e){e[e.Failsafe=0]="Failsafe",e[e.Comment=1]="Comment",e[e.Identifier=2]="Identifier",e[e.StringDoubleQuoted=3]="StringDoubleQuoted",e[e.StringBackQuoted=4]="StringBackQuoted",e[e.NumberInt32=5]="NumberInt32",e[e.NumberInt64=6]="NumberInt64",e[e.NumberFloat32=7]="NumberFloat32",e[e.NumberFloat64=8]="NumberFloat64",e[e.NumberFloat128=9]="NumberFloat128",e[e.BooleanTrue=10]="BooleanTrue",e[e.BooleanFalse=11]="BooleanFalse",e[e.Date=12]="Date",e[e.DateTime=13]="DateTime",e[e.TimeSpan=14]="TimeSpan",e[e.EndOfLine=15]="EndOfLine",e[e.EndOfFile=16]="EndOfFile",e[e.BlockOpen=17]="BlockOpen",e[e.BlockClose=18]="BlockClose",e[e.Equals=19]="Equals",e[e.Null=20]="Null",e[e.Binary=21]="Binary"}(m||(m={})),function(e){e[e.None=0]="None",e[e.CanEscapeNewLines=1]="CanEscapeNewLines",e[e.CanEscapeStringChars=2]="CanEscapeStringChars"}(_||(_={}));var y=function(){function e(e){this._input=e,this._cursor=0,this._line=0,this._column=0,this._lastPeekCharsRead=0,this._lastPeekEscaped=!1,this._lastPeekNewLineCount=0,this._lastPeekNewLineCursor=0,this._lastReadEndCursor=0,this._token={type:m.Failsafe}}return Object.defineProperty(e.prototype,"token",{get:function(){return this._token},enumerable:!1,configurable:!0}),e.prototype.read=function(){return this.readImpl()},e.prototype.clone=function(){var t=new e(this._input);return t._cursor=this._cursor,t._token=v({},this._token),t},e.prototype.toArray=function(){for(var e=[];e.push(this.read()),this.token.type!==m.EndOfFile;);return e},e.prototype.toAst=function(){var e=new p;return d(this.clone(),e),e.rootNode},e.prototype.readImpl=function(){if(this.skipSpacesAndTabs(),this.isEof())return this._token={type:m.EndOfFile},this._token;var e=this.peekChar(_.CanEscapeNewLines);if(1<this._lastPeekCharsRead&&(this._lastPeekCharsRead--,this.commitPeek(),this._lastPeekCharsRead=1),this.isCommentStartChar(e))"-"===e&&this._cursor+1<this._input.length&&"-"!==this._input[this._cursor+1]?this.readNumberOrDateOrTimeOrTimespan():this.readComment();else if(e.match(/[_a-zA-Z]/))this.readIdentifierOrBooleanOrNull();else if(e.match(/[0-9-]/))this.readNumberOrDateOrTimeOrTimespan();else if('"'===e||"`"===e)this.readString();else if("{"===e||"}"===e||"="===e)this.commitPeek(),this._token="{"===e?{type:m.BlockOpen,line:this._line,column:this._column}:"}"===e?{type:m.BlockClose,line:this._line,column:this._column}:{type:m.Equals,line:this._line,column:this._column};else if("["===e){this.commitPeek();var t=this._cursor;if(this.readToEndOrChar("]"),this.isEof())throw new Error("Unterminated Base64 sequence. Could not find ending ']' bracket.");this._token={type:m.Binary,text:this._input.slice(t,this._cursor),line:this._line,column:this._column},this._cursor++}else{if("\n"!==e&&";"!==e){if(" "===e||"\t"===e)return this.readImpl();throw new Error("Unexpected character: '"+e+"'")}this.commitPeek(),this._token={type:m.EndOfLine,line:this._line,column:this._column}}return this._token},e.prototype.readComment=function(){var e=this.nextChar(),t=this._cursor,r=0,n="";switch(e){case"#":this.readToEndOrChar("\n"),r=this._lastReadEndCursor;break;case"-":case"/":if(n=this.nextChar(),t=this._cursor,"/"===e&&"*"!==n||"/"!==e){if(n!==e)throw new Error("Expected second '"+e+"' to start a line comment, not '"+n+"'");this.readToEndOrChar("\n"),r=this._lastReadEndCursor;break}for(;;){if(r=this._cursor,this.isEof())throw new Error("Unexpected EOF when reading multi-line comment");var i=this.nextChar();if(this.isEof())throw new Error("Unexpected EOF when reading multi-line comment");var o=this.peekChar();if("*"===i&&"/"===o){this.commitPeek();break}}break;default:throw new Error("This shouldn't happen.")}this._token={type:m.Comment,line:this._line,column:this._column,text:this._input.slice(t,r)}},e.prototype.readIdentifierOrBooleanOrNull=function(){this._token={type:m.Identifier,column:this._column,line:this._line,text:"",name:"",namespace:""};for(var e=this._cursor,t=e;!this.isEof()&&(this.readToEndOrAnyChar(":"," ","=","\r","\n"),!this.isEof())&&":"===this.peekChar();)this._token.namespace=this._input.slice(e,this._cursor),this.commitPeek(),t=this._cursor;switch(this._token.text=this._input.slice(e,this._cursor),t<this._input.length&&(this._token.name=this._input.slice(t,this._cursor)),t-=t===e?0:1,this._token.text){case"true":case"on":this._token={type:m.BooleanTrue,line:this._line,column:this._column};break;case"false":case"off":this._token={type:m.BooleanFalse,line:this._line,column:this._column};break;case"null":this._token={type:m.Null,line:this._line,column:this._column}}},e.prototype.readString=function(){var e=this.nextChar(),t=this._cursor;if("`"===e){if(this.readToEndOrChar("`"),this.isEof())throw new Error("Unterminated string");return this._token={type:m.StringBackQuoted,line:this._line,column:this._column,text:this._input.slice(t,this._cursor)},void this._cursor++}for(var r="";;){if(this.isEof())throw new Error("Unterminated string");this.readToEndOrAnyChar('"',"\\");var n=this.peekChar();if('"'===n){if(0===r.length){r=this._input.slice(t,this._cursor),this.commitPeek();break}r+=this._input.slice(t,this._cursor),this.commitPeek();break}if("\\"===n){if(this._cursor++,"\n"===this.peekChar()){r+=this._input.slice(t,this._cursor-1),this.commitPeek(),this.skipSpacesAndTabs(),t=this._cursor;continue}this._cursor--,r+=this._input.slice(t,this._cursor),r+=this.nextChar(_.CanEscapeStringChars),t=this._cursor}}this._token={type:m.StringDoubleQuoted,line:this._line,column:this._column,text:r}},e.prototype.readNumberOrDateOrTimeOrTimespan=function(){var e=this._cursor;for(this.nextChar();!this.isEof();){var t=this.peekChar().toLowerCase();if(!t.match(/[0-9.]/)){if(":"===t)return this._cursor=e,void this.readTime();if("/"===t)return this._cursor=e,void this.readDateOrDateTime();if(t.match(/[\s\t\n]/)){var r=this._input.slice(e,this._cursor);return void(this._token={type:m.NumberInt32,asNumber:parseInt(r,10),line:this._line,column:this._column,text:r})}if("l"===t){var n=this._input.slice(e,this._cursor);return this._token={type:m.NumberInt64,asNumber:parseInt(n,10),line:this._line,column:this._column,text:n},void this.commitPeek()}if("f"===t){var i=this._input.slice(e,this._cursor);return this._token={type:m.NumberFloat32,asNumber:parseFloat(i),line:this._line,column:this._column,text:i},void this.commitPeek()}if("d"===t){var o=this._input.slice(e,this._cursor);return this._token={type:m.NumberFloat64,asNumber:parseFloat(o),line:this._line,column:this._column,text:o},this.commitPeek(),void(this.isEof()||":"!==this.peekChar()||(this._cursor=e,this.readTime()))}if("b"===t){this.commitPeek();var a=this.peekChar();if("d"!==a&&"D"!==a)throw new Error("Expected 'd' or 'D' following 'b' or 'B' 128-bit float suffix, but got: "+a);var s=this._input.slice(e,this._cursor-1);return this._token={type:m.NumberFloat128,asNumber:parseFloat(s),line:this._line,column:this._column,text:s},void this.commitPeek()}throw new Error("Unexpected character when parsing number/date/time: '"+t+"'")}this.commitPeek()}var u=this._input.slice(e,this._cursor);this._token={type:m.NumberInt32,asNumber:parseInt(u,10),line:this._line,column:this._column,text:u}},e.prototype.readTime=function(){function e(e,t){var r;if(0===e.length)throw new Error("No value provided for timespan "+t);if(isNaN(r=parseInt(e)))throw new Error("Invalid timespan "+t+" value: "+e);return r}var t=this;this._token={type:m.TimeSpan,column:this._column,line:this._line,days:0,hours:0,milliseconds:0,minutes:0,seconds:0,text:"",isNegative:!1};var r=this._cursor,n="-"===this.peekChar();n&&this.commitPeek();var i=!1,o=!1,a=function(){i=!1,o=!1;for(var e,r=t._cursor,n="";!t.isEof();){if((e=t.peekChar()).match(/[: \t\n.]/))return i=":"===e,o="."===e,n=t._input.slice(r,t._cursor),e.match(/[ \n\t]/)||t.commitPeek(),n;t.commitPeek()}return t._input.slice(r,t._cursor)},s=function(){if(!i)throw new Error("Expected colon")},u=a();if(s(),u.endsWith("d")){var l=u.slice(0,-1);this._token.days=e(l,"days"),u=null}null===u&&(u=a()),s(),this._token.hours=e(u,"hours"),u=a(),s(),this._token.minutes=e(u,"minutes"),u=a(),this._token.seconds=e(u,"seconds"),o&&(u=a(),this._token.milliseconds=e(u,"milliseconds")),this._token.isNegative=n,this._token.text=this._input.slice(r,this._cursor)},e.prototype.readDateOrDateTime=function(){if(this._token={type:m.DateTime,asDate:new Date,column:this._column,line:this._line,text:""},this._cursor+10>this._input.length)throw new Error("Expected 10 available characters for Date, but reached EOF. Format must be yyyy/mm/dd");var e=this._cursor;this._cursor+=10;var t=this._cursor;this.skipSpacesAndTabs();for(var r,n=!1,i=0;!this.isEof()&&!(r=this.peekChar()).match(/[ \n\t]/);)this._cursor+=this._lastPeekCharsRead,n=n||":"===r,"-"===r&&0===i&&(i=this._cursor);n?t=0<i?i-1:this._cursor:this._cursor=t;var o=this._input.slice(e,t),a=new Date(o);if(isNaN(a.getTime()))throw new Error("Invalid DateTime value: "+o);if(this._token.type=n?m.DateTime:m.Date,this._token.text=this._input.slice(e,this._cursor),0<i){var s=this._input.slice(i,this._cursor).match(/GMT([+-]?)(\d?\d?:?\d?\d?)/);if(!s||0<s[2].length&&0===s[1].length)throw new Error("Invalid timezone within DateTime, only supported format (for now!) is: -GMT+/-nn:nn and -GMT");var u=void 0,l=0;if(s[2].match(/^\d?\d$/))l=36e5*parseInt(s[2]);else if(u=s[2].match(/(\d?\d):(\d?\d)/))l=36e5*parseInt(u[1])+6e4*parseInt(u[2]);else if(0!==s[2].length)throw new Error("Invalid timezone within DateTime, use 'hh' or 'hh:mm' format. Bad format: "+s[2]);"-"===s[1]&&(l*=-1),a=new Date(a.getTime()+l)}this._token.asDate=a;var c=this._cursor-e;this._cursor=e,this._cursor+=c,this._column+=c},e.prototype.isCommentStartChar=function(e){return"#"===e||"-"===e||"/"===e},e.prototype.peekChar=function(e){void 0===e&&(e=_.None);var t=this._input[this._cursor];if(this._lastPeekNewLineCount=0,this._lastPeekCharsRead=1,this._lastPeekEscaped=!1,"\r"===t){if(this._cursor+1>=this._input.length||"\n"!==this._input[this._cursor+1])throw new Error("Stray carriage return - no line feed character following it.");t="\n",this._lastPeekCharsRead=2,this._lastPeekNewLineCount=1,this._lastPeekNewLineCursor=this._cursor+1}else if("\n"===t)this._lastPeekNewLineCount++,this._lastPeekNewLineCursor=this._cursor;else if("\\"===t){if(e&_.CanEscapeNewLines){var r=this._cursor;this._cursor++;var n=this._lastPeekCharsRead,i=this._lastPeekNewLineCount;if("\n"===(o=this.peekChar(e)))return n+=this._lastPeekCharsRead,i+=this._lastPeekNewLineCount,this._cursor+=this._lastPeekCharsRead,t=this.peekChar(e),this._lastPeekCharsRead+=n,this._lastPeekNewLineCount+=i,this._cursor=r,t}if(e&_.CanEscapeStringChars){if(this._cursor+1>=this._input.length)throw new Error("Unexpected EOF after initial escape backslash");var o=this._input[this._cursor+1];switch(this._lastPeekCharsRead=2,this._lastPeekEscaped=!0,o){case"n":t="\n";break;case"t":t="\t";break;case"r":t="\r";break;case'"':t='"';break;case"\\":t="\\";break;default:this._lastPeekEscaped=!1}if(this._lastPeekEscaped)return t}}return t},e.prototype.commitPeek=function(){this._cursor+=this._lastPeekCharsRead,0<this._lastPeekNewLineCount&&(this._line+=this._lastPeekNewLineCount,this._column=this._cursor-this._lastPeekNewLineCursor)},e.prototype.nextChar=function(e){void 0===e&&(e=_.None);var t=this.peekChar(e);return this.commitPeek(),t},e.prototype.isEof=function(){return this._cursor>=this._input.length},e.prototype.skipSpacesAndTabs=function(){for(;!this.isEof();){var e=this.peekChar();if(" "!==e&&"\t"!==e)break;this.commitPeek()}},e.prototype.readToEndOrChar=function(e){for(this._lastReadEndCursor=this._cursor;!this.isEof()&&this.peekChar()!==e;)this.commitPeek(),this._lastReadEndCursor=this._cursor},e.prototype.readToEndOrAnyChar=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(;!this.isEof();){var r=this.peekChar();if(e.includes(r))break;this.commitPeek()}},e}();return t})()}));