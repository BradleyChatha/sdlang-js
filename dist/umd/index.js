!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.sdlang=e():t.sdlang=e()}(this,(function(){return(()=>{"use strict";var t={d:(e,i)=>{for(var n in i)t.o(i,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:i[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{SdlAttribute:()=>c,SdlNamedBased:()=>r,SdlReader:()=>y,SdlTag:()=>l,SdlTokenType:()=>d,SdlValue:()=>a,SdlValueType:()=>i,parseAndVisit:()=>p});var i,n,r=function(){function t(t){this._d=t,this.qualifiedName=t}return Object.defineProperty(t.prototype,"qualifiedName",{get:function(){return this._d},set:function(t){var e=t.indexOf(":");0<=e&&(this._aspaceColonIndex=e),this._d=t,this._a=void 0,this._aspace=void 0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){if(this._a)return this._a;if(void 0!==this._aspaceColonIndex){var t=this._aspaceColonIndex+1;this._a=this._d.slice(t)}else this._a=this._d;return this._a},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"namespace",{get:function(){return this._aspace?this._aspace:void 0===this._aspaceColonIndex?"":(this._aspace=this._d.slice(0,this._aspaceColonIndex),this._aspace)},enumerable:!1,configurable:!0}),t}(),o=function(){return(o=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var r in e=arguments[i])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};(n=i||(i={}))[n.ERROR=0]="ERROR",n[n.Number=1]="Number",n[n.Boolean=2]="Boolean",n[n.Null=3]="Null",n[n.Binary=4]="Binary",n[n.String=5]="String",n[n.DateTime=6]="DateTime",n[n.TimeSpan=7]="TimeSpan";var a=function(){function t(t){if("object"!=typeof t)throw new Error("SdlValue.constructor can only take SdlValueUnion. Use the static constructors such as SdlValue.from, SdlValue.fromString, etc.");this._value=t}return t.fromTrue=function(){return new t({type:i.Boolean,value:!0})},t.fromFalse=function(){return new t({type:i.Boolean,value:!1})},t.fromBoolean=function(e){return new t({type:i.Boolean,value:e})},t.fromNull=function(){return new t({type:i.Null,value:null})},t.fromNumber=function(e){return new t({type:i.Number,value:e})},t.fromBinary=function(e){return new t({type:i.Binary,value:e})},t.fromString=function(e){return new t({type:i.String,value:e})},t.fromDateTime=function(e){return new t({type:i.DateTime,value:e})},t.fromTimeSpan=function(e){return new t({type:i.TimeSpan,value:e})},t.from=function(e){if(null===e)return t.fromNull();switch(typeof e){case"string":return t.fromString(e);case"boolean":return t.fromBoolean(e);case"number":return t.fromNumber(e);case"object":if(e instanceof Date)return t.fromDateTime(e);if(void 0!==e.days)return t.fromTimeSpan(e);throw new Error("Can't construct an SdlValue from object. Only Date and SdlTimeSpan objects are allowed: "+e);default:throw new Error("Can't construct an SdlValue from: "+e)}},Object.defineProperty(t.prototype,"number",{get:function(){return this.getValueEnforceType(this._value,i.Number)},set:function(t){this._value={type:i.Number,value:t}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"boolean",{get:function(){return this.getValueEnforceType(this._value,i.Boolean)},set:function(t){this._value={type:i.Boolean,value:t}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"null",{get:function(){return this.getValueEnforceType(this._value,i.Null)},set:function(t){this._value={type:i.Null,value:t}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"binary",{get:function(){return this.getValueEnforceType(this._value,i.Binary)},set:function(t){this._value={type:i.Binary,value:t}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"string",{get:function(){return this.getValueEnforceType(this._value,i.String)},set:function(t){this._value={type:i.String,value:t}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dateTime",{get:function(){return this.getValueEnforceType(this._value,i.DateTime)},set:function(t){this._value={type:i.DateTime,value:t}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"timeSpan",{get:function(){return this.getValueEnforceType(this._value,i.TimeSpan)},set:function(t){this._value={type:i.TimeSpan,value:t}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"type",{get:function(){return this._value.type},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){return this._value},set:function(t){this._value=t},enumerable:!1,configurable:!0}),t.prototype.clone=function(){switch(this._value.type){case i.Binary:return t.fromBinary(this._value.value);case i.Boolean:return t.fromBoolean(this._value.value);case i.DateTime:return t.fromDateTime(o({},this._value.value));case i.Null:return t.fromNull();case i.Number:return t.fromNumber(this._value.value);case i.String:return t.fromString(this._value.value);case i.TimeSpan:return t.fromTimeSpan(o({},this._value.value));default:throw new Error("Bug: This SdlValue is either uninitialised, or has a bad type: "+this.type)}},t.prototype.getValueEnforceType=function(t,e){if(t.type!==e)throw new TypeError("I am not a "+e+", I am: "+this.type);return t.value},t}(),s=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+i+" is not a constructor or null");t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),u=function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,r,o=i.call(t),a=[];try{for(;(void 0===e||0<e--)&&!(n=o.next()).done;)a.push(n.value)}catch(t){r={error:t}}finally{try{n&&!n.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}return a},l=function(t){function e(e,i){var n,r,o,a=t.call(this,e)||this;return a._0a=null!==(n=null==i?void 0:i.children)&&void 0!==n?n:[],a._0c=null!==(r=null==i?void 0:i.values)&&void 0!==r?r:[],a._0b=null!==(o=null==i?void 0:i.attributes)&&void 0!==o?o:{},a}return s(e,t),Object.defineProperty(e.prototype,"children",{get:function(){return this._0a},set:function(t){this._0a=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"attributes",{get:function(){return this._0b},set:function(t){this._0b=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"values",{get:function(){return this._0c},set:function(t){this._0c=t},enumerable:!1,configurable:!0}),e.prototype.hasValueAt=function(t){return t<this.values.length},e.prototype.hasAttributeCalled=function(t){return t in this.attributes},e.prototype.hasChildAt=function(t){return t<this.children.length},e.prototype.hasChildCalled=function(t){return void 0!==this.children.find((function(e){return e.qualifiedName===t}))},e.prototype.getChildrenCalled=function(t){return this.children.filter((function(e){return e.qualifiedName===t}))},e.prototype.getValue=function(t){return this.values[t]},e.prototype.getValueNumber=function(t){return this.values[t].number},e.prototype.getValueBoolean=function(t){return this.values[t].boolean},e.prototype.getValueBinary=function(t){return this.values[t].binary},e.prototype.getValueString=function(t){return this.values[t].string},e.prototype.getValueDateTime=function(t){return this.values[t].dateTime},e.prototype.getValueTimeSpan=function(t){return this.values[t].timeSpan},e.prototype.getValueOrDefault=function(t,e){return void 0===e&&(e=null),t>=this._0c.length?e:this._0c[t]},e.prototype.getValueNumberOrDefault=function(t,e){var i,n;return void 0===e&&(e=0),null!==(n=null===(i=this.getValueOrDefault(t))||void 0===i?void 0:i.number)&&void 0!==n?n:e},e.prototype.getValueBooleanOrDefault=function(t,e){var i,n;return void 0===e&&(e=!1),null!==(n=null===(i=this.getValueOrDefault(t))||void 0===i?void 0:i.boolean)&&void 0!==n?n:e},e.prototype.getValueBinaryOrDefault=function(t,e){var i,n;return void 0===e&&(e=null),null!==(n=null===(i=this.getValueOrDefault(t))||void 0===i?void 0:i.binary)&&void 0!==n?n:e},e.prototype.getValueStringOrDefault=function(t,e){var i,n;return void 0===e&&(e=""),null!==(n=null===(i=this.getValueOrDefault(t))||void 0===i?void 0:i.string)&&void 0!==n?n:e},e.prototype.getValueDateTimeOrDefault=function(t,e){var i,n;return void 0===e&&(e=null),null!==(n=null===(i=this.getValueOrDefault(t))||void 0===i?void 0:i.dateTime)&&void 0!==n?n:e},e.prototype.getValueTimeSpanOrDefault=function(t,e){var i,n;return void 0===e&&(e=null),null!==(n=null===(i=this.getValueOrDefault(t))||void 0===i?void 0:i.timeSpan)&&void 0!==n?n:e},e.prototype.getAttribute=function(t){return this._0b[t]},e.prototype.getAttributeValue=function(t){return this._0b[t].value},e.prototype.getAttributeNumber=function(t){return this._0b[t].value.number},e.prototype.getAttributeBoolean=function(t){return this._0b[t].value.boolean},e.prototype.getAttributeBinary=function(t){return this._0b[t].value.binary},e.prototype.getAttributeString=function(t){return this._0b[t].value.string},e.prototype.getAttributeDateTime=function(t){return this._0b[t].value.dateTime},e.prototype.getAttributeTimeSpan=function(t){return this._0b[t].value.timeSpan},e.prototype.getAttributeValueOrDefault=function(t,e){return void 0===e&&(e=null),t in this._0b?this._0b[t].value:e},e.prototype.getAttributeNumberOrDefault=function(t,e){var i,n;return void 0===e&&(e=0),null!==(n=null===(i=this.getAttributeValueOrDefault(t))||void 0===i?void 0:i.number)&&void 0!==n?n:e},e.prototype.getAttributeBooleanOrDefault=function(t,e){var i,n;return void 0===e&&(e=!1),null!==(n=null===(i=this.getAttributeValueOrDefault(t))||void 0===i?void 0:i.boolean)&&void 0!==n?n:e},e.prototype.getAttributeBinaryOrDefault=function(t,e){var i,n;return void 0===e&&(e=null),null!==(n=null===(i=this.getAttributeValueOrDefault(t))||void 0===i?void 0:i.binary)&&void 0!==n?n:e},e.prototype.getAttributeStringOrDefault=function(t,e){var i,n;return void 0===e&&(e=""),null!==(n=null===(i=this.getAttributeValueOrDefault(t))||void 0===i?void 0:i.string)&&void 0!==n?n:e},e.prototype.getAttributeDateTimeOrDefault=function(t,e){var i,n;return void 0===e&&(e=null),null!==(n=null===(i=this.getAttributeValueOrDefault(t))||void 0===i?void 0:i.dateTime)&&void 0!==n?n:e},e.prototype.getAttributeTimeSpanOrDefault=function(t,e){var i,n;return void 0===e&&(e=null),null!==(n=null===(i=this.getAttributeValueOrDefault(t))||void 0===i?void 0:i.timeSpan)&&void 0!==n?n:e},e.prototype.toString=function(t,e){function n(t){o+=t.qualifiedName,o+="=",r(t.value)}function r(t){switch(t.type){case i.Binary:o+="/*TODO, sorry!*/",o+=t.binary;break;case i.Boolean:o+=t.boolean?"true":"false";break;case i.DateTime:o+=t.dateTime.getUTCFullYear().toString().padStart(4,"0")+"/"+(t.dateTime.getUTCMonth()+1).toString().padStart(2,"0")+"/"+t.dateTime.getUTCDay().toString().padStart(2,"0")+" "+t.dateTime.getUTCHours().toString().padStart(2,"0")+":"+t.dateTime.getUTCMinutes().toString().padStart(2,"0")+":"+t.dateTime.getUTCSeconds().toString().padStart(2,"0")+"."+t.dateTime.getUTCMilliseconds().toString().padStart(3,"0")+"-GMT+0";break;case i.Null:o+="null";break;case i.Number:o+=t.number.toString(10),0==t.number%1?2147483647<t.number&&(o+="L"):o+=3402823466e29<t.number||1175494351e-47>t.number?"d":"f";break;case i.String:o+='"'+t.string+'"';break;case i.TimeSpan:o+=t.timeSpan.days+"d:"+t.timeSpan.hours.toString().padStart(2,"0")+":"+t.timeSpan.minutes.toString().padStart(2,"0")+":"+t.timeSpan.seconds.toString().padStart(2,"0");break;default:throw new Error("Unhandled value type: "+t.type)}o+=" "}void 0===t&&(t=!0),void 0===e&&(e=0);var o="";return function i(a){var s,l;if(t)return t=!1,e++,a.children.forEach((function(t){return i(t)})),void e--;o+="    ".repeat(e),"content"!==a.qualifiedName&&(o+=a.qualifiedName,o+=" "),a.values.forEach((function(t){return r(t)}));try{for(var h=function(t){var e="function"==typeof Symbol&&Symbol.iterator,i=e&&t[e],n=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(Object.entries(a.attributes)),c=h.next();!c.done;c=h.next()){var f=u(c.value,2);f[0],n(f[1])}}catch(t){s={error:t}}finally{try{c&&!c.done&&(l=h.return)&&l.call(h)}finally{if(s)throw s.error}}return 0===a.children.length?void(o+="\n"):(o+="{\n",e++,a.children.forEach((function(t){return i(t)})),e--,o+="    ".repeat(e),void(o+="}\n"))}(this),o},e}(r),h=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+i+" is not a constructor or null");t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),c=function(t){function e(e,i){var n=t.call(this,e)||this;return n._value=i,n}return h(e,t),Object.defineProperty(e.prototype,"value",{get:function(){return this._value},set:function(t){this._value=t},enumerable:!1,configurable:!0}),e}(r),f=function(){function t(){this._a=[],this._b=null}return t.prototype.reset=function(){this._a=[],this._a.push(new l("root")),this._b=null},t.prototype.visitOpenBlock=function(){if(null===this._b)throw new Error("Anonymous blocks are not supported.");this._a.push(this._b)},t.prototype.visitCloseBlock=function(){if(1===this._a.length)throw new Error("Stray '}'. We are not inside an open block (started by '{').");this._b=null,this._a.pop()},t.prototype.visitComment=function(){},t.prototype.visitStartTag=function(t){this._b=new l(t),this._a[this._a.length-1].children.push(this._b)},t.prototype.visitEndOfFile=function(){if(1!==this._a.length)throw new Error("Tag "+this._a[this._a.length-1].qualifiedName+" does not have a closing bracket '}'")},t.prototype.visitNewValue=function(t){var e;null===(e=this._b)||void 0===e||e.values.push(t)},t.prototype.visitNewAttribute=function(t,e){if(null===this._b)throw new Error("Attributes cannot be attached to anonymous tags.");if(this._b.hasAttributeCalled(e))throw new Error("Tag "+this._b.qualifiedName+" already has an attribute called "+e);this._b.attributes[e]=new c(e,t)},Object.defineProperty(t.prototype,"rootNode",{get:function(){if(1!==this._a.length)throw new Error("This visitor hasn't parsed anything yet, or the parsing failed as the root node isn't on top.");return this._a[0]},enumerable:!1,configurable:!0}),t}(),_="content";function p(t,e){function i(t){switch(t.token.type){case d.Binary:throw new Error("TODO");case d.BooleanFalse:return a.fromFalse();case d.BooleanTrue:return a.fromTrue();case d.Date:case d.DateTime:return a.fromDateTime(t.token.asDate);case d.Null:return a.fromNull();case d.NumberFloat32:case d.NumberFloat64:case d.NumberFloat128:case d.NumberInt32:case d.NumberInt64:return a.fromNumber(t.token.asNumber);case d.StringBackQuoted:case d.StringDoubleQuoted:return a.fromString(t.token.text);case d.TimeSpan:return a.fromTimeSpan({days:t.token.days,hours:t.token.hours,minutes:t.token.minutes,seconds:t.token.seconds,milliseconds:t.token.milliseconds});default:throw new Error("Expected a value token, not a token of type "+t.token.type)}}e.reset();var n=null,r=!0;for(t.read();t.token.type!==d.EndOfFile;){switch(t.token.type){case d.Binary:case d.BooleanFalse:case d.BooleanTrue:case d.Date:case d.DateTime:case d.NumberFloat128:case d.NumberFloat32:case d.NumberFloat64:case d.NumberInt32:case d.NumberInt64:case d.StringBackQuoted:case d.StringDoubleQuoted:case d.TimeSpan:r&&e.visitStartTag(_,"",_),e.visitNewValue(i(t));break;case d.BlockClose:e.visitCloseBlock();break;case d.BlockOpen:e.visitOpenBlock();break;case d.Comment:e.visitComment(t.token.text);break;case d.EndOfLine:r=!0,t.read();continue;case d.Identifier:if((n=t.clone()).read(),n.token.type===d.Equals){r&&e.visitStartTag(_,"",_),n.read(),e.visitNewAttribute(i(n),t.token.text,t.token.namespace,t.token.name),t.read(),t.read();break}if(r){e.visitStartTag(t.token.text,t.token.namespace,t.token.name);break}throw new Error("Orphaned identifier. Were you trying to make an attribute? Name = "+t.token.text);default:throw new Error("Unexpected token of type "+t.token.type)}r=!1,t.read()}e.visitEndOfFile()}var d,b,m=function(){return(m=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var r in e=arguments[i])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};!function(t){t[t.Failsafe=0]="Failsafe",t[t.Comment=1]="Comment",t[t.Identifier=2]="Identifier",t[t.StringDoubleQuoted=3]="StringDoubleQuoted",t[t.StringBackQuoted=4]="StringBackQuoted",t[t.NumberInt32=5]="NumberInt32",t[t.NumberInt64=6]="NumberInt64",t[t.NumberFloat32=7]="NumberFloat32",t[t.NumberFloat64=8]="NumberFloat64",t[t.NumberFloat128=9]="NumberFloat128",t[t.BooleanTrue=10]="BooleanTrue",t[t.BooleanFalse=11]="BooleanFalse",t[t.Date=12]="Date",t[t.DateTime=13]="DateTime",t[t.TimeSpan=14]="TimeSpan",t[t.EndOfLine=15]="EndOfLine",t[t.EndOfFile=16]="EndOfFile",t[t.BlockOpen=17]="BlockOpen",t[t.BlockClose=18]="BlockClose",t[t.Equals=19]="Equals",t[t.Null=20]="Null",t[t.Binary=21]="Binary"}(d||(d={})),function(t){t[t.None=0]="None",t[t.CanEscapeNewLines=1]="CanEscapeNewLines",t[t.CanEscapeStringChars=2]="CanEscapeStringChars"}(b||(b={}));var y=function(){function t(t){this._i=t,this._a=0,this._c=0,this._d=0,this._e=0,this._f=!1,this._g=0,this._h=0,this._j=0,this._b={type:d.Failsafe}}return Object.defineProperty(t.prototype,"token",{get:function(){return this._b},enumerable:!1,configurable:!0}),t.prototype.read=function(){return this._0()},t.prototype.clone=function(){var e=new t(this._i);return e._a=this._a,e._b=m({},this._b),e},t.prototype.toArray=function(){for(var t=[];t.push(this.read()),this.token.type!==d.EndOfFile;);return t},t.prototype.toAst=function(){var t=new f;return p(this.clone(),t),t.rootNode},t.prototype._0=function(){if(this._m(),this._l())return this._b={type:d.EndOfFile},this._b;var t=this._8(b.CanEscapeNewLines);if(1<this._e&&(this._e--,this._9(),this._e=1),this._7(t))"-"===t&&this._a+1<this._i.length&&"-"!==this._i[this._a+1]?this._4():this._1();else if(t.match(/[_a-zA-Z]/))this._2();else if(t.match(/[0-9-]/))this._4();else if('"'===t||"`"===t)this._3();else if("{"===t||"}"===t||"="===t)this._9(),this._b="{"===t?{type:d.BlockOpen,line:this._c,column:this._d}:"}"===t?{type:d.BlockClose,line:this._c,column:this._d}:{type:d.Equals,line:this._c,column:this._d};else if("["===t){this._9();var e=this._a;if(this._n("]"),this._l())throw new Error("Unterminated Base64 sequence. Could not find ending ']' bracket.");this._b={type:d.Binary,text:this._i.slice(e,this._a),line:this._c,column:this._d},this._a++}else{if("\n"!==t&&";"!==t){if(" "===t||"\t"===t)return this._0();throw new Error("Unexpected character: '"+t+"'")}this._9(),this._b={type:d.EndOfLine,line:this._c,column:this._d}}return this._b},t.prototype._1=function(){var t=this._k(),e=this._a,i=0,n="";switch(t){case"#":this._n("\n"),i=this._j;break;case"-":case"/":if(n=this._k(),e=this._a,"/"===t&&"*"!==n||"/"!==t){if(n!==t)throw new Error("Expected second '"+t+"' to start a line comment, not '"+n+"'");this._n("\n"),i=this._j;break}for(;;){if(i=this._a,this._l())throw new Error("Unexpected EOF when reading multi-line comment");var r=this._k();if(this._l())throw new Error("Unexpected EOF when reading multi-line comment");var o=this._8();if("*"===r&&"/"===o){this._9();break}}break;default:throw new Error("This shouldn't happen.")}this._b={type:d.Comment,line:this._c,column:this._d,text:this._i.slice(e,i)}},t.prototype._2=function(){this._b={type:d.Identifier,column:this._d,line:this._c,text:"",name:"",namespace:""};for(var t=this._a,e=t;!this._l()&&(this._o(":"," ","=","\r","\n"),!this._l())&&":"===this._8();)this._b.namespace=this._i.slice(t,this._a),this._9(),e=this._a;switch(this._b.text=this._i.slice(t,this._a),e<this._i.length&&(this._b.name=this._i.slice(e,this._a)),e-=e===t?0:1,this._b.text){case"true":case"on":this._b={type:d.BooleanTrue,line:this._c,column:this._d};break;case"false":case"off":this._b={type:d.BooleanFalse,line:this._c,column:this._d};break;case"null":this._b={type:d.Null,line:this._c,column:this._d}}},t.prototype._3=function(){var t=this._k(),e=this._a;if("`"===t){if(this._n("`"),this._l())throw new Error("Unterminated string");return this._b={type:d.StringBackQuoted,line:this._c,column:this._d,text:this._i.slice(e,this._a)},void this._a++}for(var i="";;){if(this._l())throw new Error("Unterminated string");this._o('"',"\\");var n=this._8();if('"'===n){if(0===i.length){i=this._i.slice(e,this._a),this._9();break}i+=this._i.slice(e,this._a),this._9();break}if("\\"===n){if(this._a++,"\n"===this._8()){i+=this._i.slice(e,this._a-1),this._9(),this._m(),e=this._a;continue}this._a--,i+=this._i.slice(e,this._a),i+=this._k(b.CanEscapeStringChars),e=this._a}}this._b={type:d.StringDoubleQuoted,line:this._c,column:this._d,text:i}},t.prototype._4=function(){var t=this._a;for(this._k();!this._l();){var e=this._8().toLowerCase();if(!e.match(/[0-9.]/)){if(":"===e)return this._a=t,void this._5();if("/"===e)return this._a=t,void this._6();if(e.match(/[\s\t\n]/)){var i=this._i.slice(t,this._a);return void(this._b={type:d.NumberInt32,asNumber:parseInt(i,10),line:this._c,column:this._d,text:i})}if("l"===e){var n=this._i.slice(t,this._a);return this._b={type:d.NumberInt64,asNumber:parseInt(n,10),line:this._c,column:this._d,text:n},void this._9()}if("f"===e){var r=this._i.slice(t,this._a);return this._b={type:d.NumberFloat32,asNumber:parseFloat(r),line:this._c,column:this._d,text:r},void this._9()}if("d"===e){var o=this._i.slice(t,this._a);return this._b={type:d.NumberFloat64,asNumber:parseFloat(o),line:this._c,column:this._d,text:o},this._9(),void(this._l()||":"!==this._8()||(this._a=t,this._5()))}if("b"===e){this._9();var a=this._8();if("d"!==a&&"D"!==a)throw new Error("Expected 'd' or 'D' following 'b' or 'B' 128-bit float suffix, but got: "+a);var s=this._i.slice(t,this._a-1);return this._b={type:d.NumberFloat128,asNumber:parseFloat(s),line:this._c,column:this._d,text:s},void this._9()}throw new Error("Unexpected character when parsing number/date/time: '"+e+"'")}this._9()}var u=this._i.slice(t,this._a);this._b={type:d.NumberInt32,asNumber:parseInt(u,10),line:this._c,column:this._d,text:u}},t.prototype._5=function(){function t(t,e){var i;if(0===t.length)throw new Error("No value provided for timespan "+e);if(isNaN(i=parseInt(t)))throw new Error("Invalid timespan "+e+" value: "+t);return i}var e=this;this._b={type:d.TimeSpan,column:this._d,line:this._c,days:0,hours:0,milliseconds:0,minutes:0,seconds:0,text:"",isNegative:!1};var i=this._a,n="-"===this._8();n&&this._9();var r=!1,o=!1,a=function(){r=!1,o=!1;for(var t,i=e._a,n="";!e._l();){if((t=e._8()).match(/[: \t\n.]/))return r=":"===t,o="."===t,n=e._i.slice(i,e._a),t.match(/[ \n\t]/)||e._9(),n;e._9()}return e._i.slice(i,e._a)},s=function(){if(!r)throw new Error("Expected colon")},u=a();if(s(),u.endsWith("d")){var l=u.slice(0,-1);this._b.days=t(l,"days"),u=null}null===u&&(u=a()),s(),this._b.hours=t(u,"hours"),u=a(),s(),this._b.minutes=t(u,"minutes"),u=a(),this._b.seconds=t(u,"seconds"),o&&(u=a(),this._b.milliseconds=t(u,"milliseconds")),this._b.isNegative=n,this._b.text=this._i.slice(i,this._a)},t.prototype._6=function(){if(this._b={type:d.DateTime,asDate:new Date,column:this._d,line:this._c,text:""},this._a+10>this._i.length)throw new Error("Expected 10 available characters for Date, but reached EOF. Format must be yyyy/mm/dd");var t=this._a;this._a+=10;var e=this._a;this._m();for(var i,n=!1,r=0;!this._l()&&!(i=this._8()).match(/[ \n\t]/);)this._a+=this._e,n=n||":"===i,"-"===i&&0===r&&(r=this._a);n?e=0<r?r-1:this._a:this._a=e;var o=this._i.slice(t,e),a=new Date(o);if(isNaN(a.getTime()))throw new Error("Invalid DateTime value: "+o);if(this._b.type=n?d.DateTime:d.Date,this._b.text=this._i.slice(t,this._a),0<r){var s=this._i.slice(r,this._a).match(/GMT([+-]?)(\d?\d?:?\d?\d?)/);if(!s||0<s[2].length&&0===s[1].length)throw new Error("Invalid timezone within DateTime, only supported format (for now!) is: -GMT+/-nn:nn and -GMT");var u=void 0,l=0;if(s[2].match(/^\d?\d$/))l=36e5*parseInt(s[2]);else if(u=s[2].match(/(\d?\d):(\d?\d)/))l=36e5*parseInt(u[1])+6e4*parseInt(u[2]);else if(0!==s[2].length)throw new Error("Invalid timezone within DateTime, use 'hh' or 'hh:mm' format. Bad format: "+s[2]);"-"===s[1]&&(l*=-1),a=new Date(a.getTime()+l)}this._b.asDate=a;var h=this._a-t;this._a=t,this._a+=h,this._d+=h},t.prototype._7=function(t){return"#"===t||"-"===t||"/"===t},t.prototype._8=function(t){void 0===t&&(t=b.None);var e=this._i[this._a];if(this._g=0,this._e=1,this._f=!1,"\r"===e){if(this._a+1>=this._i.length||"\n"!==this._i[this._a+1])throw new Error("Stray carriage return - no line feed character following it.");e="\n",this._e=2,this._g=1,this._h=this._a+1}else if("\n"===e)this._g++,this._h=this._a;else if("\\"===e){if(t&b.CanEscapeNewLines){var i=this._a;this._a++;var n=this._e,r=this._g;if("\n"===(o=this._8(t)))return n+=this._e,r+=this._g,this._a+=this._e,e=this._8(t),this._e+=n,this._g+=r,this._a=i,e}if(t&b.CanEscapeStringChars){if(this._a+1>=this._i.length)throw new Error("Unexpected EOF after initial escape backslash");var o=this._i[this._a+1];switch(this._e=2,this._f=!0,o){case"n":e="\n";break;case"t":e="\t";break;case"r":e="\r";break;case'"':e='"';break;case"\\":e="\\";break;default:this._f=!1}if(this._f)return e}}return e},t.prototype._9=function(){this._a+=this._e,0<this._g&&(this._c+=this._g,this._d=this._a-this._h)},t.prototype._k=function(t){void 0===t&&(t=b.None);var e=this._8(t);return this._9(),e},t.prototype._l=function(){return this._a>=this._i.length},t.prototype._m=function(){for(;!this._l();){var t=this._8();if(" "!==t&&"\t"!==t)break;this._9()}},t.prototype._n=function(t){for(this._j=this._a;!this._l()&&this._8()!==t;)this._9(),this._j=this._a},t.prototype._o=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(;!this._l();){var i=this._8();if(t.includes(i))break;this._9()}},t}();return e})()}));